# How to run

These scripts perform the frailty analysis for a particular exposure - outcome hypothesis. We need to run 1000 simulations, and this is most easily achieved using bluecrystal3.

## Getting the scripts

Do this on bc3. 

1. Add git: `module add tools/git-1.8.4.2`
2. Clone the directory: `git clone git@github.com:explodecomputer/mr_frailty.git`
3. Install the required R packages
    ```
    install.packages(c("Runuran", "dplyr", "ggplot2", "devtools", "systemfit"))
    devtools::install_github("MRCIEU/TwoSampleMR")
    ```

## Setup

Navigate to `mr_frailty/inst/analysis/edu_az/scripts`.

The `model1.R` script contains the parameters to run a single model. Only modify this file to change the parameters.

## Running

The `run_model1.sh` script contains the directives for BC3 to run the job in parallel. You can specify the model script to run (line 28) the number of batches to run (line 7) and the number of jobs per batch (line 21).

To run:

```
qsub run_model1.sh
```

To check the status of things you can run

```
showq -u <username>
```


## Aggregating

A number of results files will have been generated by the cluster after this is finished. To aggregate those results into a single large results file:

```
Rscript aggregate_model1.R
```

You can change where it should look for the results and where to save the aggregated file by modifying the first few lines.


